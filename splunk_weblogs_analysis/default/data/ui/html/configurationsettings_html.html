<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>ConfigurationSettings | Splunk</title>
    <link rel="shortcut icon" href="{{SPLUNKWEB_URL_PREFIX}}/static/img/favicon.ico" />
        <link rel="stylesheet" type="text/css" href="{{SPLUNKWEB_URL_PREFIX}}/static/css/build/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="{{SPLUNKWEB_URL_PREFIX}}/static/css/build/pages/dashboard-simple-bootstrap.min.css" />
    <!--[if IE 7]><link rel="stylesheet" href="{{SPLUNKWEB_URL_PREFIX}}/static/css/sprites-ie7.css" /><![endif]-->
</head>
<body class="simplexml preload locale-en">
<!-- 
BEGIN LAYOUT
This section contains the layout for the dashboard. Splunk uses proprietary
styles in <div> tags, similar to Bootstrap's grid system. 
-->
<a class="navSkip" href="#navSkip" tabindex="1">Screen reader users, click here to skip the navigation bar</a>
<div class="header splunk-header">
        <div id="placeholder-splunk-bar">
            <a href="{{SPLUNKWEB_URL_PREFIX}}/app/launcher/home" class="brand" title="splunk &gt; listen to your data">splunk<strong>&gt;</strong></a>
        </div>
            <div id="placeholder-app-bar"></div>
</div>
<a id="navSkip"></a>
<div class="dashboard-body container-fluid main-section-body" data-role="main">
    <div class="dashboard-header clearfix">
        <h2>Configuration Settings</h2>
    </div>
    <div class="fieldset">
		
		<div class="settings" id="settings">
		<input type="hidden" id="serverIPHidden" readonly="true"/>
		<input type="hidden" id="serverPortHidden" readonly="true"/>
		<table style="align:center;">
		<tr><td>
            <span>WM Server IP : </span></td><td><input type="text" name="serverIP" id="serverIP" readonly="true"/>
		</td></tr><tr><td>
			<span>WM Server Port : </span></td><td><input type="text" name="serverPort" id="serverPort" readonly="true"/>
		</td></tr>
		</table>
		
        </div>
		<br/>
		
		<div class="ResponseLabel" id="ResponseLabel" style="align:center;"></div>
		<br/>
		<div class="form-submit" >
            <button class="btn btn-primary submit" id="edit">Edit&nbsp;</button>
        </div>
        <div class="form-submit" >
            <button class="btn btn-primary submit" id="save">Save&nbsp;</button>
        </div>
		 <div class="form-submit" >
            <button class="btn btn-primary submit" id="reset">Reset</button>
        </div>
		</div><br/><br/>
        
		
    </div>


</div>
<div class="footer"></div>

<!-- 
END LAYOUT
-->

<script src="{{SPLUNKWEB_URL_PREFIX}}/config?autoload=1"></script>
<script src="{{SPLUNKWEB_URL_PREFIX}}/static/js/i18n.js"></script>
<script src="{{SPLUNKWEB_URL_PREFIX}}/i18ncatalog?autoload=1"></script>
<script src="{{SPLUNKWEB_URL_PREFIX}}/static/js/build/simplexml.min/config.js"></script>
<script type="text/javascript">
require.config({
    baseUrl: "{{SPLUNKWEB_URL_PREFIX}}/static/js",
    waitSeconds: 0 // Disable require.js load timeout
});

//
// LIBRARY REQUIREMENTS
//
// In the require function, we include the necessary libraries and modules for
// the HTML dashboard. Then, we pass variable names for these libraries and
// modules as function parameters, in order.
// 
// When you add libraries or modules, remember to retain this mapping order
// between the library or module and its function parameter. You can do this by
// adding to the end of these lists, as shown in the commented examples below.

require([
    "splunkjs/mvc",
    "splunkjs/mvc/utils",
    "splunkjs/mvc/tokenutils",
    "underscore",
    "jquery",
    "splunkjs/mvc/simplexml",
    "splunkjs/mvc/headerview",
    "splunkjs/mvc/footerview",
    "splunkjs/mvc/simplexml/dashboardview",
    "splunkjs/mvc/simplexml/dashboard/panelref",
    "splunkjs/mvc/simplexml/element/chart",
    "splunkjs/mvc/simplexml/element/event",
    "splunkjs/mvc/simplexml/element/html",
    "splunkjs/mvc/simplexml/element/list",
    "splunkjs/mvc/simplexml/element/map",
    "splunkjs/mvc/simplexml/element/single",
    "splunkjs/mvc/simplexml/element/table",
    "splunkjs/mvc/simpleform/formutils",
    "splunkjs/mvc/simplexml/eventhandler",
    "splunkjs/mvc/simpleform/input/dropdown",
    "splunkjs/mvc/simpleform/input/radiogroup",
    "splunkjs/mvc/simpleform/input/multiselect",
    "splunkjs/mvc/simpleform/input/checkboxgroup",
    "splunkjs/mvc/simpleform/input/text",
    "splunkjs/mvc/simpleform/input/timerange",
    "splunkjs/mvc/simpleform/input/submit",
    "splunkjs/mvc/searchmanager",
    "splunkjs/mvc/savedsearchmanager",
    "splunkjs/mvc/postprocessmanager",
    "splunkjs/mvc/simplexml/urltokenmodel"
    // Add comma-separated libraries and modules manually here, for example:
    // ..."splunkjs/mvc/simplexml/urltokenmodel",
    // "splunkjs/mvc/checkboxview"
    ],
    function(
        mvc,
        utils,
        TokenUtils,
        _,
        $,
        DashboardController,
        HeaderView,
        FooterView,
        Dashboard,
        PanelRef,
        ChartElement,
        EventElement,
        HtmlElement,
        ListElement,
        MapElement,
        SingleElement,
        TableElement,
        FormUtils,
        EventHandler,
        DropdownInput,
        RadioGroupInput,
        MultiSelectInput,
        CheckboxGroupInput,
        TextInput,
        TimeRangeInput,
        SubmitButton,
        SearchManager,
        SavedSearchManager,
        PostProcessManager,
        UrlTokenModel

        // Add comma-separated parameter names here, for example: 
        // ...UrlTokenModel, 
        // CheckboxView
        ) {



        var pageLoading = true;
		//retrieving app name
		var app = utils.getCurrentApp();
		console.log(app);

        // 
        // TOKENS
        //
        
        // Create token namespaces
        var urlTokenModel = new UrlTokenModel();
        mvc.Components.registerInstance('url', urlTokenModel);
        var defaultTokenModel = mvc.Components.getInstance('default', {create: true});
        var submittedTokenModel = mvc.Components.getInstance('submitted', {create: true});

        urlTokenModel.on('url:navigate', function() {
            defaultTokenModel.set(urlTokenModel.toJSON());
            if (!_.isEmpty(urlTokenModel.toJSON()) && !_.all(urlTokenModel.toJSON(), _.isUndefined)) {
                submitTokens();
            } else {
                submittedTokenModel.clear();
            }
        });

        // Initialize tokens
        defaultTokenModel.set(urlTokenModel.toJSON());

        function submitTokens() {
            // Copy the contents of the defaultTokenModel to the submittedTokenModel and urlTokenModel
            FormUtils.submitForm({ replaceState: pageLoading });
        }

        function setToken(name, value) {
            defaultTokenModel.set(name, value);
            submittedTokenModel.set(name, value);
        }

        function unsetToken(name) {
            defaultTokenModel.unset(name);
            submittedTokenModel.unset(name);
        }

        
        
        //
        // SEARCH MANAGERS
        //



        //
        // SPLUNK HEADER AND FOOTER
        //

        new HeaderView({
            id: 'header',
            section: 'dashboards',
            el: $('.header'),
            acceleratedAppNav: true,
            useSessionStorageCache: true,
            splunkbar: true,
            appbar: true,
            litebar: false,
        }, {tokens: true}).render();

        new FooterView({
            id: 'footer',
            el: $('.footer')
        }, {tokens: true}).render();


        //
        // DASHBOARD EDITOR
        //

        new Dashboard({
            id: 'dashboard',
            el: $('.dashboard-body'),
            showTitle: true,
            editable: true
        }, {tokens: true}).render();


        //
        // VIEWS: VISUALIZATION ELEMENTS
        //



        //
        // VIEWS: FORM INPUTS
        //


        // 
        // SUBMIT FORM DATA
        //

        // Initialize time tokens to default
        if (!defaultTokenModel.has('earliest') && !defaultTokenModel.has('latest')) {
            defaultTokenModel.set({ earliest: '0', latest: '' });
        }

            submitTokens();


        //
        // DASHBOARD READY
        //

        DashboardController.ready();
        pageLoading = false;


		//load existing configurations
		function loadConfigtoUI(app)
		{
			var url = Splunk.util.make_url("/custom/"+app+"/wurflconfigeditor/getConfigDisplay");
			var u={namespace:app};
					$.ajax({
						url: url,
						type:"POST",
						data:u,
						async:false,
						complete: function(y,A){
							console.log("completed from loadConfigtoUI");
							var z=true;
							if(y.status==404){
								$("#ResponseLabel").html("<p style='color:#FF0000'>config.properties File is not found</p>");
							}else if(y.status==405){
								$("#ResponseLabel").html("<p style='color:#FF0000'>Error in accessing properties fields</p>");
							}
							else if(y.status==500){
								$("#ResponseLabel").html("<p style='color:#FF0000'>The properties file can not be saved</p>");}
							},
						success: function(data){
							console.log("from loadConfigtoUI:\n"+data);
							$("#serverIP").val("");	
							$("#serverPort").val("");
							$("#serverIPHidden").val("");	
							$("#serverPortHidden").val("");
							var response = JSON.parse(data);
							console.log(response);		
							var serverip =  response.serverip;
							var serverport =  response.serverport;
							$("#serverIP").val(serverip);	
							$("#serverPort").val(serverport);
							$("#serverIPHidden").val(serverip);	
							$("#serverPortHidden").val(serverport);
							console.log("values set");
							$("#serverIP").attr("readonly", true);	
							$("#serverPort").attr("readonly", true);
						}
					})
		}
		$(document).ready(function() {
				loadConfigtoUI(app);
			}
		
		);
		$("#edit").click(function () {
				//alert("clicked edit button");
				$("#serverIP").attr("readonly", false);	
				$("#serverPort").attr("readonly", false);
				
		});
		$("#save").click(function () {
			//calling rest api
			var serverip =   $.trim($("#serverIP").val());
			var serverport =   $.trim($("#serverPort").val());
			var serveripHidden =   $.trim($("#serverIPHidden").val());
			var serverportHidden =   $.trim($("#serverPortHidden").val());
			console.log(serverip+"\t"+serveripHidden);
			console.log(serverport+"\t"+serverportHidden);
			if(serverip == "")
			{
				$("#ResponseLabel").html("<p style='color:#e68123'>Server IP should not be empty</p>");	
			}
			else if(serverport == "")
			{
				$("#ResponseLabel").html("<p style='color:#e68123'>Server Port should not be empty</p>");	
			}
			else if((serveripHidden == "") || (serverportHidden == ""))
			{
				$("#ResponseLabel").html("<p style='color:#e68123'>Provide valid paths.. Try by refreshing the page once</p>");
			}
			else{
					if(!((serverip == serveripHidden) && (serverport == serverportHidden)))
					{
								console.log("Both are not same");
								//if(selectedCapabilities.toString() == )
								var url = Splunk.util.make_url("/custom/"+app+"/wurflconfigeditor/save");
								console.log(url);
								var u={namespace:app, serverip:serverip, serverport:serverport, serveripold:serveripHidden, serverportold:serverportHidden }
								console.log(u);
								$.ajax({
									url: url,
									type:"POST",
									data:u,
									complete: function(y,A){
									console.log("completed updating config file");
									var z=true;
									console.log(y)
									console.log(A)
									if(y.status==404){
									$("#ResponseLabel").html("<p style='color:#e68123'>config.properties File is not found</p>");
									}else if(y.status==405){
										$("#ResponseLabel").html("<p style='color:#e68123'>Error in accessing properties file fields</p>");
									}
									else if(y.status==406){
										$("#ResponseLabel").html("<p style='color:#e68123'>"+y.responseText+"</p>");
									}
									else if(y.status==500){
									$("#ResponseLabel").html("<p style='color:#e68123'>config.properties file can not be saved</p>");}
									},
									success: function(data){
										console.log(data);
										$("#ResponseLabel").html("<p style='color:#000000'>"+data+"</p>");
										loadConfigtoUI(app);
									}
								})
					}
					else{
						$("#ResponseLabel").html("<p style='color:#e68123'> Modified Configurations are already in configured </p>");
					}
			}
				
		});
		$("#reset").click(function () {
			var url = Splunk.util.make_url("/custom/"+app+"/wurflconfigeditor/restoreToDefaultPaths");
			var u={namespace:app};
					$.ajax({
						url: url,
						type:"POST",
						data:u,
						async:false,
						complete: function(y,A){
							console.log("completed from loadConfigtoUI");
							var z=true;
							if(y.status==404){
								$("#ResponseLabel").html("<p style='color:#FF0000'>config.properties File is not found</p>");
							}else if(y.status==405){
								$("#ResponseLabel").html("<p style='color:#FF0000'>Error in accessing properties fields</p>");
							}
							else if(y.status==500){
								$("#ResponseLabel").html("<p style='color:#FF0000'>The properties file can not be saved</p>");}
							},
						success: function(data){
							console.log(data);
							//$("#ResponseLabel").html("<p style='color:#000000'>"+data+"</p>");
							//loadConfigtoUI(app);
							$("#serverIP").val("");	
							$("#serverPort").val("");
							var response = JSON.parse(data);
							console.log(response);		
							var serverip =  response.serverip;
							var serverport =  response.serverport;
							$("#serverIP").val(serverip);	
							$("#serverPort").val(serverport);
							console.log("values set");
							$("#serverIP").attr("readonly", true);	
							$("#serverPort").attr("readonly", true);
						}
					})	
				
		});
    }
);
</script>
</body>
</html>
